{"ast":null,"code":"import _objectSpread from\"/Users/mac/Desktop/data/application/EFrontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useLoading}from'../LoadingContext';import{isIPhoneSafari,createIPhoneSafeRequest,handleIPhoneError}from'../utils/iphoneFix';export const useApi=()=>{const{startLoading,stopLoading}=useLoading();const apiCall=async function(url){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};let loadingMessage=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'Loading...';try{startLoading(loadingMessage);// Skip iPhone detection for login endpoints to avoid interference\nconst isLoginEndpoint=url.includes('/login')||url.includes('/instructor-login');let requestOptions;if(isLoginEndpoint){// Use standard request for login endpoints\nrequestOptions=_objectSpread(_objectSpread({credentials:'include'},options),{},{headers:_objectSpread({'Content-Type':'application/json'},options.headers)});}else{// Use iPhone-safe request for other endpoints\nconst{options:iphoneOptions}=createIPhoneSafeRequest(url,options);requestOptions=iphoneOptions;}const response=await fetch(url,requestOptions);const data=await response.json();if(!response.ok){throw new Error(data.message||'Something went wrong');}return data;}catch(error){console.error('API Error:',error);// Skip iPhone retry logic for login endpoints\nconst isLoginEndpoint=url.includes('/login')||url.includes('/instructor-login');if(!isLoginEndpoint&&handleIPhoneError(error)){// Retry with fallback token\ntry{const fallbackToken=localStorage.getItem('fallbackToken');if(fallbackToken){const retryOptions=_objectSpread(_objectSpread({},options),{},{headers:_objectSpread(_objectSpread({},options.headers),{},{'Authorization':\"Bearer \".concat(fallbackToken),'Content-Type':'application/json'})});const retryResponse=await fetch(url,_objectSpread(_objectSpread({},retryOptions),{},{credentials:'include'}));const retryData=await retryResponse.json();if(!retryResponse.ok){throw new Error(retryData.message||'Something went wrong');}return retryData;}}catch(retryError){console.error('Retry failed:',retryError);}}throw error;}finally{stopLoading();}};const get=function(url){let loadingMessage=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'Loading...';return apiCall(url,{method:'GET'},loadingMessage);};const post=function(url,body){let loadingMessage=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'Saving...';return apiCall(url,{method:'POST',body:JSON.stringify(body)},loadingMessage);};const put=function(url,body){let loadingMessage=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'Updating...';return apiCall(url,{method:'PUT',body:JSON.stringify(body)},loadingMessage);};const patch=function(url,body){let loadingMessage=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'Updating...';return apiCall(url,{method:'PATCH',body:JSON.stringify(body)},loadingMessage);};const del=function(url){let loadingMessage=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'Deleting...';return apiCall(url,{method:'DELETE'},loadingMessage);};return{apiCall,get,post,put,patch,del};};","map":{"version":3,"names":["useLoading","isIPhoneSafari","createIPhoneSafeRequest","handleIPhoneError","useApi","startLoading","stopLoading","apiCall","url","options","arguments","length","undefined","loadingMessage","isLoginEndpoint","includes","requestOptions","_objectSpread","credentials","headers","iphoneOptions","response","fetch","data","json","ok","Error","message","error","console","fallbackToken","localStorage","getItem","retryOptions","concat","retryResponse","retryData","retryError","get","method","post","body","JSON","stringify","put","patch","del"],"sources":["/Users/mac/Desktop/data/application/EFrontend/src/hooks/useApi.js"],"sourcesContent":["import { useLoading } from '../LoadingContext';\nimport { isIPhoneSafari, createIPhoneSafeRequest, handleIPhoneError } from '../utils/iphoneFix';\n\nexport const useApi = () => {\n  const { startLoading, stopLoading } = useLoading();\n\n  const apiCall = async (url, options = {}, loadingMessage = 'Loading...') => {\n    try {\n      startLoading(loadingMessage);\n      \n      // Skip iPhone detection for login endpoints to avoid interference\n      const isLoginEndpoint = url.includes('/login') || url.includes('/instructor-login');\n      \n      let requestOptions;\n      if (isLoginEndpoint) {\n        // Use standard request for login endpoints\n        requestOptions = {\n          credentials: 'include',\n          ...options,\n          headers: {\n            'Content-Type': 'application/json',\n            ...options.headers,\n          },\n        };\n      } else {\n        // Use iPhone-safe request for other endpoints\n        const { options: iphoneOptions } = createIPhoneSafeRequest(url, options);\n        requestOptions = iphoneOptions;\n      }\n      \n      const response = await fetch(url, requestOptions);\n\n      const data = await response.json();\n      \n      if (!response.ok) {\n        throw new Error(data.message || 'Something went wrong');\n      }\n      \n      return data;\n    } catch (error) {\n      console.error('API Error:', error);\n      \n      // Skip iPhone retry logic for login endpoints\n      const isLoginEndpoint = url.includes('/login') || url.includes('/instructor-login');\n      \n      if (!isLoginEndpoint && handleIPhoneError(error)) {\n        // Retry with fallback token\n        try {\n          const fallbackToken = localStorage.getItem('fallbackToken');\n          if (fallbackToken) {\n            const retryOptions = {\n              ...options,\n              headers: {\n                ...options.headers,\n                'Authorization': `Bearer ${fallbackToken}`,\n                'Content-Type': 'application/json',\n              }\n            };\n            \n            const retryResponse = await fetch(url, {\n              ...retryOptions,\n              credentials: 'include',\n            });\n            \n            const retryData = await retryResponse.json();\n            if (!retryResponse.ok) {\n              throw new Error(retryData.message || 'Something went wrong');\n            }\n            \n            return retryData;\n          }\n        } catch (retryError) {\n          console.error('Retry failed:', retryError);\n        }\n      }\n      \n      throw error;\n    } finally {\n      stopLoading();\n    }\n  };\n\n  const get = (url, loadingMessage = 'Loading...') => {\n    return apiCall(url, { method: 'GET' }, loadingMessage);\n  };\n\n  const post = (url, body, loadingMessage = 'Saving...') => {\n    return apiCall(url, { \n      method: 'POST', \n      body: JSON.stringify(body) \n    }, loadingMessage);\n  };\n\n  const put = (url, body, loadingMessage = 'Updating...') => {\n    return apiCall(url, { \n      method: 'PUT', \n      body: JSON.stringify(body) \n    }, loadingMessage);\n  };\n\n  const patch = (url, body, loadingMessage = 'Updating...') => {\n    return apiCall(url, { \n      method: 'PATCH', \n      body: JSON.stringify(body) \n    }, loadingMessage);\n  };\n\n  const del = (url, loadingMessage = 'Deleting...') => {\n    return apiCall(url, { method: 'DELETE' }, loadingMessage);\n  };\n\n  return {\n    apiCall,\n    get,\n    post,\n    put,\n    patch,\n    del,\n  };\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}